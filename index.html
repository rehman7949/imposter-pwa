<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Imposter ‚Äì Partyspiel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0e0f13">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <style>
    :root{
      --bg:#0e0f13;
      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);
      --text:#ecf1f8;
      --muted:#b7bec9;
      --accent:#7c5cff;   /* prim√§rer Akzent */
      --accent-2:#08d3c0; /* sekund√§rer Akzent */
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);background: radial-gradient(1200px 800px at 20% -10%, #1c1e27 0, transparent 60%),
                 radial-gradient(1200px 900px at 120% 10%, #0b1b2a 0, transparent 55%), var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap{max-width:880px;margin:0 auto;padding: max(24px, env(safe-area-inset-top)) 20px 28px}
    header{
      display:flex;align-items:center;gap:12px;margin-bottom:18px;
    }
    .logo{
      width:40px;height:40px; border-radius:12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display:grid;place-items:center; font-weight:800; color:#0f1020;
      box-shadow: 0 10px 24px rgba(124,92,255,.35);
    }
    h1{font-size:clamp(22px, 3.6vw, 32px);margin:0}
    .subtitle{color:var(--muted);font-size:14px}
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:20px; margin:16px 0;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.04), 0 6px 24px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      transition: transform .15s ease, border-color .2s ease;
    }
    .card:hover{ transform: translateY(-1px); border-color: rgba(124,92,255,.35) }
    label{display:block;margin:8px 0 6px;font-weight:600}
    input,select,button{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
      background:#111421;color:var(--text); font-size:15px;
    }
    .btn{
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border: none; color:#0d0f16; font-weight:800; letter-spacing:.2px; cursor:pointer;
      box-shadow: 0 12px 28px rgba(124,92,255,.35);
      transition: transform .08s ease, filter .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.995) }
    .btn[disabled]{ filter: grayscale(1) opacity(.6); cursor:not-allowed; box-shadow:none }
    .btn-ghost{ background:#111421;border:1px solid var(--border);color:var(--text);box-shadow:none }
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > *{flex:1 1 220px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#111421;border:1px solid var(--border);font-size:13px}
    .center{text-align:center}
    .muted{color:var(--muted);font-size:14px}
    .big{font-size: clamp(28px, 6vw, 48px); letter-spacing:.5px; margin: 20px 0; font-weight:900}
    .timer{font-variant-numeric:tabular-nums;font-size:22px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .player-tag{background:#15192a;border:1px dashed var(--border);padding:10px 12px;border-radius:12px}
    .kicker{font-size:12px; text-transform:uppercase; letter-spacing:.18em; color:#9aa3b2}
    footer{margin-top:24px;color:var(--muted);font-size:12px}
    /* Install-Hint */
    #install-hint{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6); backdrop-filter: blur(3px); z-index:9999}
    #install-hint .box{ background:#151827; border:1px solid var(--border); border-radius:18px; padding:18px; max-width:520px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">üïµÔ∏è</div>
      <div>
        <h1>Imposter</h1>
        <div class="subtitle">Social-Deduction Partyspiel ‚Ä¢ PWA</div>
      </div>
    </header>

    <div id="app"></div>

    <footer>
      <div class="kicker">Hinweis</div>
      <div>F√ºge diese Seite auf dem iPhone √ºber <b>Teilen ‚Üí ‚ÄûZum Home-Bildschirm‚Äú</b> hinzu, um die App zu installieren.</div>
    </footer>
  </div>

  <!-- iOS Install Overlay -->
  <div id="install-hint">
    <div class="box">
      <h3>Auf dem iPhone installieren</h3>
      <p class="muted">Tippe auf das <b>Teilen-Symbol</b> und w√§hle <b>‚ÄûZum Home-Bildschirm‚Äú</b>, um die App zu installieren.</p>
      <button id="closeHint" class="btn">Verstanden</button>
    </div>
  </div>

  <script>
    // PWA bootstrap (Service Worker)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('/service-worker.js'));
    }
    // iOS Install-Hinweis (nur wenn nicht als Standalone l√§uft)
    (function(){
      const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
      const isStandalone = window.navigator.standalone === true;
      if (isIOS && !isStandalone) {
        const hint = document.getElementById('install-hint');
        hint.style.display = 'grid';
        document.getElementById('closeHint').onclick = () => hint.style.display = 'none';
      }
    })();
  </script>

  <script>
  (function() {
    // --- State Machine ---
    const State = { LOBBY:'LOBBY', REVEAL:'REVEAL', DISCUSS:'DISCUSS', VOTE:'VOTE', RESULT:'RESULT' };
    let game = {
      state: State.LOBBY,
      players: [],
      topic: null,
      imposterId: null,
      revealIndex: 0,
      discussEndsAt: 0,
      votes: {},
      options: { discussSeconds: 120, rounds: 1 }
    };

    const TOPICS = [
      { common: "Islam", imposter: "Horizont" },
      { common: "Iman", imposter: "Wurzeln" },
      { common: "Allah", imposter: "Unsichtbar" },
      { common: "Koran", imposter: "Nacht" },
      { common: "Sunnah", imposter: "Spuren" },
      { common: "Hadith", imposter: "Ketten" },
      { common: "Tauhid", imposter: "Spitze" },
      { common: "Schahada", imposter: "Tor" },
      { common: "Prophet Muhammad Ô∑∫", imposter: "Mond" },
      { common: "Adam", imposter: "Ton" },
      { common: "Nuh", imposter: "Bogen" },
      { common: "Ibrahim", imposter: "Flammen" },
      { common: "Musa", imposter: "Meer" },
      { common: "Isa", imposter: "Tisch" },
      { common: "Yusuf", imposter: "Hemd" },
      { common: "Yunus", imposter: "Bauch" },
      { common: "Ayyub", imposter: "Geduld" },
      { common: "Maryam", imposter: "Palme" },
      { common: "Ismail", imposter: "Messer" },
      { common: "Dawud", imposter: "Stimme" },
    
      { common: "Kaaba", imposter: "Schwarz" },
      { common: "Mekka", imposter: "Quelle" },
      { common: "Medina", imposter: "Oase" },
      { common: "Jerusalem", imposter: "Kette" },
      { common: "Arafat", imposter: "Schatten" },
      { common: "Mina", imposter: "Zelte" },
      { common: "Moschee", imposter: "Teppiche" },
      { common: "Minbar", imposter: "Stufen" },
      { common: "Mihrab", imposter: "Bogen" },
      { common: "Kibla", imposter: "Pfeil" },
      { common: "Masjid al-Haram", imposter: "Kreis" },
      { common: "Masjid al-Aqsa", imposter: "Felsen" },
      { common: "Zamzam", imposter: "Kind" },
      { common: "Uhud", imposter: "Rot" },
      { common: "Badr", imposter: "313" },
      { common: "Kufa", imposter: "Brief" },
      { common: "Damaskus", imposter: "Licht" },
      { common: "Bagdad", imposter: "Haus" },
      { common: "Kairo", imposter: "Nil" },
      { common: "Granada", imposter: "Bogen" },
    
      { common: "Ramadan", imposter: "Schl√ºssel" },
      { common: "Schawwal", imposter: "Sechs" },
      { common: "Dh≈´ l-Hiddscha", imposter: "Wei√ü" },
      { common: "Muharram", imposter: "Tr√§nen" },
      { common: "Safar", imposter: "Gelb" },
      { common: "Rabi ø al-Awwal", imposter: "Geburt" },
      { common: "Lailatul Qadr", imposter: "1000" },
      { common: "Jumu øa", imposter: "Versammlung" },
      { common: "Aschura", imposter: "Durst" },
      { common: "Laylat al-Miraj", imposter: "Reise" },
      { common: "Iftar", imposter: "Datteln" },
      { common: "Suhoor", imposter: "Finsternis" },
      { common: "Eid al-Fitr", imposter: "Neues Kleid" },
      { common: "Eid al-Adha", imposter: "Blut" },
      { common: "Mawlid", imposter: "Kerzen" },
      { common: "Tarawih", imposter: "N√§chte" },
      { common: "Tahajjud", imposter: "Stille" },
      { common: "Fajr", imposter: "Rot" },
      { common: "Maghrib", imposter: "Schatten" },
      { common: "Isha", imposter: "Dunkelheit" },
    
      { common: "Salat", imposter: "Linie" },
      { common: "Zakat", imposter: "Gewicht" },
      { common: "Sawm", imposter: "Durst" },
      { common: "Hadsch", imposter: "Steine" },
      { common: "Umrah", imposter: "Kreis" },
      { common: "Adhan", imposter: "T√ºrme" },
      { common: "Iqama", imposter: "Aufstehen" },
      { common: "Dua", imposter: "Handfl√§chen" },
      { common: "Wudu", imposter: "Tropfen" },
      { common: "Ghusl", imposter: "Quelle" },
      { common: "Hijab", imposter: "Grenze" },
      { common: "Niqab", imposter: "Schleier" },
      { common: "Kufi", imposter: "Rund" },
      { common: "Tasbih", imposter: "Perlen" },
      { common: "Muezzin", imposter: "Stimme" },
      { common: "Sadaqa", imposter: "L√§cheln" },
      { common: "Fitra", imposter: "Natur" },
      { common: "Halal", imposter: "Gr√ºn" },
      { common: "Haram", imposter: "Rot" },
      { common: "Awrah", imposter: "Schutz" },
    
      { common: "Sabr", imposter: "Stein" },
      { common: "Schukr", imposter: "Ernte" },
      { common: "Rahma", imposter: "Regen" },
      { common: "Adl", imposter: "Waage" },
      { common: "Ikhlas", imposter: "Spiegel" },
      { common: "Jihad", imposter: "Pfad" },
      { common: "Shura", imposter: "Kreis" },
      { common: "Bismillah", imposter: "Beginn" },
      { common: "Alhamdulillah", imposter: "Ende" },
      { common: "InshaAllah", imposter: "Morgen" },
      { common: "Astaghfirullah", imposter: "Staub" },
      { common: "SubhanAllah", imposter: "Sterne" },
      { common: "Takbir", imposter: "Echo" },
      { common: "Hijra", imposter: "Spuren" },
      { common: "Badr", imposter: "W√ºste" },
      { common: "Uhud", imposter: "Berg" },
      { common: "Karbala", imposter: "Asche" },
      { common: "Andalus", imposter: "G√§rten" },
      { common: "Osmanisches Reich", imposter: "Halbmond" },
      { common: "Sultan", imposter: "Thron" }
    ];

    const $ = (s)=>document.querySelector(s);
    function uid(){ return Math.random().toString(36).slice(2,10); }
    function now(){ return Date.now(); }
    function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${m}:${String(r).padStart(2,'0')}`; }

    function render(){
      const app = $('#app'); app.innerHTML='';
      const c = document.createElement('div'); c.className='card'; app.appendChild(c);

      if (game.state===State.LOBBY){
        c.innerHTML = `
          <div class="kicker">Lobby</div>
          <h2 style="margin:6px 0 2px">Neue Runde starten</h2>
          <div class="muted">3‚Äì12 Spieler ¬∑ 1 Imposter</div>

          <div class="row" style="margin-top:14px">
            <div>
              <label>Spieler hinzuf√ºgen</label>
              <div class="row" style="gap:10px">
                <input id="nameInput" placeholder="Name eingeben..." />
                <button id="addBtn" class="btn" style="flex:0 0 160px">Hinzuf√ºgen</button>
              </div>
              <div id="players" class="row" style="margin-top:10px"></div>
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <div>
              <label>Diskussion (Sekunden)</label>
              <input id="secs" type="number" min="30" max="600" value="${game.options.discussSeconds}">
            </div>
            <div>
              <label>Runden</label>
              <input id="rounds" type="number" min="1" max="10" value="${game.options.rounds}">
            </div>
          </div>

          <button id="startBtn" class="btn" style="margin-top:16px" ${game.players.length<3?'disabled':''}>Spiel starten</button>
        `;
        const bag = c.querySelector('#players');
        game.players.forEach(p=>{
          const tag = document.createElement('div');
          tag.className='player-tag';
          tag.textContent = p.name;
          bag.appendChild(tag);
        });

        c.querySelector('#addBtn').onclick = () => {
          const val = c.querySelector('#nameInput').value.trim();
          if(!val) return;
          game.players.push({ id:uid(), name:val });
          render();
        };
        c.querySelector('#secs').onchange = e => game.options.discussSeconds = Math.max(30, Math.min(600, +e.target.value||120));
        c.querySelector('#rounds').onchange = e => game.options.rounds = Math.max(1, Math.min(10, +e.target.value||1));
        c.querySelector('#startBtn').onclick = startGame;

      } else if (game.state===State.REVEAL){
        const current = game.players[game.revealIndex];
        c.innerHTML = `
          <div class="kicker">Rollen zeigen</div>
          <h2 style="margin:6px 0 12px">Ger√§t zu <span style="color:var(--accent-2)">${current.name}</span> geben</h2>
          <p class="muted">Tippe auf <b>Wort anzeigen</b>, merke es dir heimlich und tippe dann auf <b>Fertig</b>.</p>
          <div class="row" style="margin-top:14px">
            <button id="showBtn" class="btn">Wort anzeigen</button>
            <button id="doneBtn" class="btn btn-ghost">Fertig</button>
          </div>
          <div id="wordBox" class="center" style="display:none">
            <div class="big" id="wordVal"></div>
            <div class="pill" style="margin-top:6px">Nur f√ºr dich sichtbar</div>
          </div>
        `;
        c.querySelector('#showBtn').onclick=()=>{
          c.querySelector('#wordBox').style.display='block';
          const isImp = current.id===game.imposterId;
          c.querySelector('#wordVal').textContent = isImp ? game.topic.imposter : game.topic.common;
        };
        c.querySelector('#doneBtn').onclick=()=>{
          game.revealIndex++;
          if (game.revealIndex>=game.players.length){
            game.state=State.DISCUSS;
            game.discussEndsAt = now() + game.options.discussSeconds*1000;
          }
          render();
        };

      } else if (game.state===State.DISCUSS){
        const secsLeft = Math.max(0, Math.ceil((game.discussEndsAt - now())/1000));
        c.innerHTML = `
          <div class="kicker">Diskussion</div>
          <h2 style="margin:6px 0 4px">Beschreibt euer Wort, ohne es zu verraten</h2>
          <div class="center" style="margin:18px 0">
            <div class="timer" id="timer" style="font-weight:800">${fmt(secsLeft)}</div>
          </div>
          <button id="toVoteBtn" class="btn">${secsLeft===0?'Zur Abstimmung':'Vorzeitig zur Abstimmung'}</button>
        `;
        const interval = setInterval(()=>{
          if (game.state!==State.DISCUSS) return clearInterval(interval);
          const el = document.getElementById('timer');
          if (!el) return clearInterval(interval);
          const left = Math.max(0, Math.ceil((game.discussEndsAt - now())/1000));
          el.textContent = fmt(left);
          if (left<=0) clearInterval(interval);
        },300);
        c.querySelector('#toVoteBtn').onclick=()=>{ game.state=State.VOTE; render(); };

      } else if (game.state===State.VOTE){
        c.innerHTML = `
          <div class="kicker">Abstimmung</div>
          <h2 style="margin:6px 0 10px">Wer ist der Imposter?</h2>
          <div id="voteGrid" class="grid" style="margin-top:10px"></div>
          <button id="finishBtn" class="btn" style="margin-top:16px" ${Object.keys(game.votes).length<game.players.length?'disabled':''}>Abstimmung abschlie√üen</button>
        `;
        const grid = c.querySelector('#voteGrid');
        game.players.forEach(voter=>{
          const card = document.createElement('div');
          card.className='card';
          card.innerHTML = `
            <div style="font-weight:700;margin-bottom:8px">${voter.name}</div>
            <select id="sel-${voter.id}">
              <option value="">‚Äî w√§hlt verd√§chtig ‚Äî</option>
              ${game.players.map(p=>`<option value="${p.id}">${p.name}</option>`).join('')}
            </select>
          `;
          grid.appendChild(card);
          const sel = card.querySelector(`#sel-${voter.id}`);
          sel.value = game.votes[voter.id] || '';
          sel.onchange=()=>{
            const v = sel.value;
            if (v===voter.id){ alert("Du kannst nicht f√ºr dich selbst stimmen."); sel.value=game.votes[voter.id]||''; return; }
            if (v) game.votes[voter.id]=v; else delete game.votes[voter.id];
            document.getElementById('finishBtn').disabled = Object.keys(game.votes).length < game.players.length;
          };
        });
        c.querySelector('#finishBtn').onclick = computeResult;

      } else if (game.state===State.RESULT){
        const tally = tallyVotes(game.votes);
        const top = Object.entries(tally).sort((a,b)=>b[1]-a[1])[0] || [null,0];
        const accusedId = top[0];
        const accused = game.players.find(p=>p.id===accusedId);
        const imp = game.players.find(p=>p.id===game.imposterId);
        const win = accusedId===game.imposterId ? 'Crew gewinnt üéâ' : 'Imposter gewinnt üòà';

        c.innerHTML = `
          <div class="kicker">Ergebnis</div>
          <h2 style="margin:6px 0 8px">${win}</h2>
          <div class="row">
            <div class="pill">Crew-Thema: <b>${game.topic.common}</b></div>
            <div class="pill">Imposter-Thema: <b>${game.topic.imposter}</b></div>
          </div>
          <div class="card" style="margin-top:12px">
            <div><b>Beschuldigt:</b> ${accused ? accused.name : '‚Äî'}</div>
            <div><b>Imposter:</b> ${imp.name}</div>
          </div>
          <div class="card">
            <b>Stimmen</b>
            <div style="margin-top:8px">
              ${Object.entries(tally).map(([pid,count])=>{
                const p = game.players.find(x=>x.id===pid);
                return `<div>${p ? p.name : '‚Äî'}: ${count}</div>`;
              }).join('')}
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="againBtn" class="btn">Nochmal spielen</button>
            <button id="resetBtn" class="btn btn-ghost">Neue Lobby</button>
          </div>
        `;
        c.querySelector('#againBtn').onclick=()=>{ nextRound(); render(); };
        c.querySelector('#resetBtn').onclick=()=>{ game = {...game, state:State.LOBBY, players:[], votes:{} }; render(); };
      }
    }

    function startGame(){
      if (game.players.length<3) return;
      const impIndex = Math.floor(Math.random()*game.players.length);
      game.imposterId = game.players[impIndex].id;
      game.topic = TOPICS[Math.floor(Math.random()*TOPICS.length)];
      game.revealIndex = 0;
      game.votes = {};
      game.state = State.REVEAL;
      render();
    }
    function tallyVotes(votes){
      const t={}; Object.values(votes).forEach(pid=>{ if(!pid) return; t[pid]=(t[pid]||0)+1; }); return t;
    }
    function computeResult(){ game.state=State.RESULT; render(); }
    function nextRound(){
      const impIndex = Math.floor(Math.random()*game.players.length);
      game.imposterId = game.players[impIndex].id;
      game.topic = TOPICS[Math.floor(Math.random()*TOPICS.length)];
      game.revealIndex = 0; game.votes={}; game.state=State.REVEAL;
    }

    // Demo-Seed
  })();
  </script>
</body>
</html>
