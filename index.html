<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Imposter â€“ Partyspiel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#f5efe6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png">
  <style>
<style>
:root{
  --bg:#f5efe6;      /* heller Beigeton */
  --text:#111111;    /* schwarze Schrift */
  --muted:#5a5a5a;
  --card:#fffaf2;
  --border:#e8dcc6;
  --radius:18px;

  /* dezente, elegante Akzente */
  --accent:#C97D60;   /* terracotta */
  --accent-2:#0FA3B1; /* teal */
}

/* Grundlayout */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}
.wrap{ max-width:980px; margin:0 auto; padding: max(20px, env(safe-area-inset-top)) 16px 24px }
header{ display:flex; align-items:center; gap:12px; margin:12px 0 8px }
.logo{
  width:44px; height:44px; border-radius:12px;
  background: var(--bg);
  border:3px solid var(--accent);
  display:grid; place-items:center; font-weight:900; font-size:18px; color:var(--accent);
}
h1{ font-size:clamp(22px, 4.8vw, 34px); margin:0 }
.sub{ color:var(--muted); font-size:14px }

/* Karten, Formelemente, Buttons */
.card{
  background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
  padding:18px; margin:16px 0; box-shadow: 0 6px 24px rgba(0,0,0,.06);
}
label{ display:block; font-weight:700; margin:8px 0 6px }
input,select,button{
  width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
  background:#fff; color:var(--text); font-size:15px;
}
.row{ display:flex; gap:12px; flex-wrap:wrap }
.row > *{ flex:1 1 240px }
.btn{
  background:#111; color:#fff; border:none; cursor:pointer; font-weight:800; letter-spacing:.2px;
  transition: transform .07s ease, filter .2s ease;
}
.btn:active{ transform: translateY(1px) }
.btn[disabled]{ filter: grayscale(1) opacity(.6); cursor:not-allowed }
.btn-outline{ background:#fff; border:1px solid var(--border); color:var(--text); }
.muted{ color:var(--muted) }
.pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#fff }
.grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px }
.player-tag{ background:#fff; border:1px dashed var(--border); padding:10px 12px; border-radius:12px }
.big{ font-size: clamp(26px, 6vw, 46px); font-weight:900; letter-spacing:.5px; margin: 16px 0 }
.center{ text-align:center }
.kicker{ font-size:12px; text-transform:uppercase; letter-spacing:.18em; color:#666 }

/* elegante, dezente Linie oben/unten */
.ribbon{
  height:6px;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  border-radius:999px;
  opacity:.75;
  box-shadow: 0 2px 8px rgba(0,0,0,.06), inset 0 1px 0 rgba(255,255,255,.25);
}
.ribbon.thin{ height:3px; opacity:.9 }

/* Reveal-Karte (Swipe-up) */
.reveal-wrap{ position:relative; height:210px; border-radius:16px; overflow:hidden; background:#fff; border:1px solid var(--border) }
.reveal-content{ position:absolute; inset:0; display:grid; place-items:center; padding:16px }
.reveal-scrim{
  position:absolute; inset:0; background:var(--card); border-top:6px solid var(--accent-2);
  display:flex; align-items:flex-end; justify-content:center; padding:12px;
  transform: translateY(0); touch-action:none; cursor:grab;
  transition: transform .18s ease;
}
.scrim-handle{ width:54px; height:6px; background:#ccc; border-radius:999px; margin-bottom:10px }
.scrim-label{ font-size:13px; color:var(--muted); margin-bottom:12px }

/* RTL fÃ¼r Arabisch */
[dir="rtl"] .row{ flex-direction: row-reverse }
[dir="rtl"] select, [dir="rtl"] input{ direction: rtl }

footer{ margin-top:20px; color:var(--muted); font-size:12px }
</style>
</head>
<body>
  <div class="ribbon"></div>
  <div class="wrap">
    <header>
      <div class="logo">I</div>
      <div>
        <h1>Imposter</h1>
        <div class="sub">Social-Deduction Partyspiel â€¢ PWA</div>
      </div>
    </header>
    <div class="ribbon thin"></div>

    <div id="app"></div>

    <footer>
      <div class="kicker">Installation</div>
      <div class="muted">Auf dem iPhone Ã¼ber <b>Teilen â†’ â€Zum Home-Bildschirmâ€œ</b> hinzufÃ¼gen.</div>
    </footer>
  </div>

  <script>
  (function(){
    // ---------- Internationalisierung ----------
    const i18n = {
      de: {
        next_player: "NÃ¤chster Spieler",
        start_round: "Spiel starten",
        start_title: "Willkommen",
        start_sub: "WÃ¤hle Sprache & Kategorie",
        language: "Sprache",
        category: "Kategorie",
        cat_islamic: "Islamische Begriffe",
        cat_general: "Allgemeine Begriffe",
        continue: "Weiter",
        lobby_title: "Lobby",
        players_hint: "3â€“12 Spieler Â· 1 Imposter",
        add_player: "Spieler hinzufÃ¼gen",
        name_placeholder: "Name eingeben...",
        discussion_secs: "Diskussion (Sekunden)",
        rounds: "Runden",
        start_game: "Spiel starten",
        reveal_title: "Rollen zeigen",
        pass_device_to: "GerÃ¤t zu <b>{name}</b> geben",
        show_word: "Wort anzeigen",
        done: "Fertig",
        swipe_up: "Karte hochziehen zum Anzeigen",
        you_are_imposter: "âš ï¸ Du bist der Imposter!",
        discuss_title: "Diskussion",
        go_vote: "Zur Abstimmung",
        early_vote: "Vorzeitig zur Abstimmung",
        vote_title: "Abstimmung",
        choose_sus: "â€” wÃ¤hlt verdÃ¤chtig â€”",
        finish_vote: "Abstimmung abschlieÃŸen",
        result_title: "Ergebnis",
        accused: "Beschuldigt",
        imposter: "Imposter",
        crew_wins: "Crew gewinnt ğŸ‰",
        imposter_wins: "Imposter gewinnt ğŸ˜ˆ",
        play_again: "Nochmal spielen",
        new_lobby: "Neue Lobby",
        starter: "Starter",
        begin_prompt: "Beginnen muss: <b>{name}</b>"
      },
      en: {
        next_player: "Next player",
        start_round: "Start round",
        start_title: "Welcome",
        start_sub: "Choose language & category",
        language: "Language",
        category: "Category",
        cat_islamic: "Islamic terms",
        cat_general: "General terms",
        continue: "Continue",
        lobby_title: "Lobby",
        players_hint: "3â€“12 players Â· 1 impostor",
        add_player: "Add player",
        name_placeholder: "Enter name...",
        discussion_secs: "Discussion (seconds)",
        rounds: "Rounds",
        start_game: "Start game",
        reveal_title: "Reveal",
        pass_device_to: "Pass device to <b>{name}</b>",
        show_word: "Show word",
        done: "Done",
        swipe_up: "Pull card up to reveal",
        you_are_imposter: "âš ï¸ You are the impostor!",
        discuss_title: "Discussion",
        go_vote: "Go to voting",
        early_vote: "Go to voting early",
        vote_title: "Voting",
        choose_sus: "â€” choose suspicious â€”",
        finish_vote: "Finish voting",
        result_title: "Result",
        accused: "Accused",
        imposter: "Impostor",
        crew_wins: "Crew wins ğŸ‰",
        imposter_wins: "Impostor wins ğŸ˜ˆ",
        play_again: "Play again",
        new_lobby: "New lobby",
        starter: "Starter",
        begin_prompt: "Starting player: <b>{name}</b>"
      },
      ar: {
        next_player: "Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ",
        start_round: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©",
        start_title: "Ù…Ø±Ø­Ø¨Ù‹Ø§",
        start_sub: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„ÙØ¦Ø©",
        language: "Ø§Ù„Ù„ØºØ©",
        category: "Ø§Ù„ÙØ¦Ø©",
        cat_islamic: "Ù…ØµØ·Ù„Ø­Ø§Øª Ø¥Ø³Ù„Ø§Ù…ÙŠØ©",
        cat_general: "Ù…ØµØ·Ù„Ø­Ø§Øª Ø¹Ø§Ù…Ø©",
        continue: "Ù…ØªØ§Ø¨Ø¹Ø©",
        lobby_title: "Ø§Ù„Ø±Ø¯Ù‡Ø©",
        players_hint: "Ù£â€“Ù¡Ù¢ Ù„Ø§Ø¹Ø¨ÙŠÙ† Â· Ù…Ø­ØªØ§Ù„ ÙˆØ§Ø­Ø¯",
        add_player: "Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨",
        name_placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…...",
        discussion_secs: "Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)",
        rounds: "Ø§Ù„Ø¬ÙˆÙ„Ø§Øª",
        start_game: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©",
        reveal_title: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Ø±",
        pass_device_to: "Ø£Ø¹Ø·Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¥Ù„Ù‰ <b>{name}</b>",
        show_word: "Ø§Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø©",
        done: "ØªÙ…",
        swipe_up: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„ÙƒØ´Ù",
        you_are_imposter: "âš ï¸ Ø£Ù†Øª Ø§Ù„Ù…Ø­ØªØ§Ù„!",
        discuss_title: "Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©",
        go_vote: "Ø§Ø°Ù‡Ø¨ Ù„Ù„ØªØµÙˆÙŠØª",
        early_vote: "Ø§Ø°Ù‡Ø¨ Ù„Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø¢Ù†",
        vote_title: "Ø§Ù„ØªØµÙˆÙŠØª",
        choose_sus: "â€” Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ â€”",
        finish_vote: "Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª",
        result_title: "Ø§Ù„Ù†ØªÙŠØ¬Ø©",
        accused: "Ø§Ù„Ù…ØªÙ‡Ù…",
        imposter: "Ø§Ù„Ù…Ø­ØªØ§Ù„",
        crew_wins: "ÙØ§Ø² Ø§Ù„ÙØ±ÙŠÙ‚ ğŸ‰",
        imposter_wins: "ÙØ§Ø² Ø§Ù„Ù…Ø­ØªØ§Ù„ ğŸ˜ˆ",
        play_again: "Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ù‹Ø§",
        new_lobby: "Ø±Ø¯Ù‡Ø© Ø¬Ø¯ÙŠØ¯Ø©",
        starter: "Ø§Ù„Ø¨Ø§Ø¯Ø¦",
        begin_prompt: "Ø³ÙŠØ¨Ø¯Ø£: <b>{name}</b>"
      }
    };

    // ---------- Themenpools ----------
    // Platzhalter fÃ¼r islamische Begriffe â€“ HIER Deine Liste einfÃ¼gen:
    const TOPICS_ISLAMIC = [
      // { common:"", imposter:"" },
      { common: "Allah", imposter: "Ewigkeit" },
      { common: "Islam", imposter: "Weg" },
      { common: "Iman", imposter: "Wurzeln" },
      { common: "Koran", imposter: "Nacht" },
      { common: "Sunnah", imposter: "Spuren" },
      { common: "Hadith", imposter: "Ketten" },
      { common: "Tauhid", imposter: "Spitze" },
      { common: "Schahada", imposter: "Tor" },
      { common: "Prophet Muhammad ï·º", imposter: "Siegelring" },
      { common: "Adam", imposter: "Garten" },
      
      { common: "Nuh", imposter: "Boot" },
      { common: "Ibrahim", imposter: "Sterne" },
      { common: "Musa", imposter: "Korb" },
      { common: "Isa", imposter: "Tisch" },
      { common: "Yusuf", imposter: "Brunnen" },
      { common: "Yunus", imposter: "Schatten" },
      { common: "Ayyub", imposter: "Geduld" },
      { common: "Maryam", imposter: "Kind" },
      { common: "Ismail", imposter: "Messer" },
      { common: "Dawud", imposter: "Stimme" },
      
      { common: "Kaaba", imposter: "Leere" },
      { common: "Mekka", imposter: "Quelle" },
      { common: "Medina", imposter: "Oase" },
      { common: "Jerusalem", imposter: "Felsen" },
      { common: "Arafat", imposter: "Schatten" },
      { common: "Mina", imposter: "Zelte" },
      { common: "Moschee", imposter: "Schuhe" },
      { common: "Minbar", imposter: "Stufen" },
      { common: "Mihrab", imposter: "Bogen" },
      { common: "Kibla", imposter: "Pfeil" },
      
      { common: "Masjid al-Haram", imposter: "Kreis" },
      { common: "Masjid al-Aqsa", imposter: "Kette" },
      { common: "Zamzam", imposter: "Kind" },
      { common: "Uhud", imposter: "Rot" },
      { common: "Badr", imposter: "313" },
      { common: "Kufa", imposter: "Brief" },
      { common: "Damaskus", imposter: "Licht" },
      { common: "Bagdad", imposter: "Haus" },
      { common: "Kairo", imposter: "Nil" },
      { common: "Granada", imposter: "GÃ¤rten" },
      
      { common: "Ramadan", imposter: "Mond" },
      { common: "Schawwal", imposter: "Sechs" },
      { common: "DhÅ« l-Hiddscha", imposter: "WeiÃŸ" },
      { common: "Muharram", imposter: "TrÃ¤nen" },
      { common: "Safar", imposter: "Gelb" },
      { common: "RabiÊ¿ al-Awwal", imposter: "Geburt" },
      { common: "Lailatul Qadr", imposter: "1000" },
      { common: "JumuÊ¿a", imposter: "Predigt" },
      { common: "Aschura", imposter: "Durst" },
      { common: "Laylat al-Miraj", imposter: "Reise" },
      
      { common: "Iftar", imposter: "Datteln" },
      { common: "Suhoor", imposter: "Finsternis" },
      { common: "Eid al-Fitr", imposter: "Neues Kleid" },
      { common: "Eid al-Adha", imposter: "Messer" },
      { common: "Mawlid", imposter: "Kerzen" },
      { common: "Tarawih", imposter: "NÃ¤chte" },
      { common: "Tahajjud", imposter: "Stille" },
      { common: "Fajr", imposter: "Rot" },
      { common: "Maghrib", imposter: "Schatten" },
      { common: "Isha", imposter: "Dunkelheit" },
      
      { common: "Salat", imposter: "Linie" },
      { common: "Zakat", imposter: "Waage" },
      { common: "Sawm", imposter: "Durst" },
      { common: "Hadsch", imposter: "Steine" },
      { common: "Umrah", imposter: "Kreis" },
      { common: "Adhan", imposter: "TÃ¼rme" },
      { common: "Iqama", imposter: "Aufstehen" },
      { common: "Dua", imposter: "HandflÃ¤chen" },
      { common: "Wudu", imposter: "Tropfen" },
      { common: "Ghusl", imposter: "Quelle" },
      
      { common: "Hijab", imposter: "Schutz" },
      { common: "Niqab", imposter: "Schleier" },
      { common: "Kufi", imposter: "Rund" },
      { common: "Tasbih", imposter: "Finger" },
      { common: "Muezzin", imposter: "Stimme" },
      { common: "Sadaqa", imposter: "LÃ¤cheln" },
      { common: "Fitra", imposter: "Natur" },
      { common: "Halal", imposter: "Siegel" },
      { common: "Haram", imposter: "Grenze" },
      { common: "Awrah", imposter: "Schleier" },
      
      { common: "Sabr", imposter: "Stein" },
      { common: "Schukr", imposter: "Ernte" },
      { common: "Rahma", imposter: "Regen" },
      { common: "Adl", imposter: "Waage" },
      { common: "Ikhlas", imposter: "Spiegel" },
      { common: "Jihad", imposter: "Pfad" },
      { common: "Shura", imposter: "Kreis" },
      { common: "Bismillah", imposter: "Beginn" },
      { common: "Alhamdulillah", imposter: "Ende" },
      { common: "InshaAllah", imposter: "Morgen" },
      
      { common: "Astaghfirullah", imposter: "Staub" },
      { common: "SubhanAllah", imposter: "Sterne" },
      { common: "Takbir", imposter: "Echo" },
      { common: "Hijra", imposter: "Spuren" },
      { common: "Badr (Schlacht)", imposter: "WÃ¼ste" },
      { common: "Uhud (Schlacht)", imposter: "Berg" },
      { common: "Karbala", imposter: "Asche" },
      { common: "Andalus", imposter: "PalÃ¤ste" },
      { common: "Osmanisches Reich", imposter: "Halbmond" },
      { common: "Sultan", imposter: "Thron" }
    ];

    // Allgemeine (auch kniffligere) Paare:
    const TOPICS_GENERAL = [
{ common: "Freiheit", imposter: "FlÃ¼gel" },
{ common: "Vertrauen", imposter: "BrÃ¼cke" },
{ common: "Erinnerung", imposter: "Foto" },
{ common: "Geheimnis", imposter: "SchlÃ¼ssel" },
{ common: "Hoffnung", imposter: "Kerze" },
{ common: "Gerechtigkeit", imposter: "Waage" },
{ common: "Verlust", imposter: "Leere" },
{ common: "Stille", imposter: "WÃ¼ste" },
{ common: "Abenteuer", imposter: "Karte" },
{ common: "Leidenschaft", imposter: "Feuer" },

{ common: "Einsamkeit", imposter: "Schatten" },
{ common: "Zeitreise", imposter: "Spirale" },
{ common: "Schicksal", imposter: "Weg" },
{ common: "Illusion", imposter: "Spiegel" },
{ common: "Erfolg", imposter: "Krone" },
{ common: "TÃ¤uschung", imposter: "Maske" },
{ common: "Erkenntnis", imposter: "Licht" },
{ common: "VerÃ¤nderung", imposter: "Fluss" },
{ common: "Sehnsucht", imposter: "Horizont" },
{ common: "Gelegenheit", imposter: "TÃ¼r" },

{ common: "EnttÃ¤uschung", imposter: "Glas" },
{ common: "Vorurteil", imposter: "Mauer" },
{ common: "Vergebung", imposter: "Hand" },
{ common: "Mut", imposter: "LÃ¶we" },
{ common: "Angst", imposter: "Nebel" },
{ common: "StÃ¤rke", imposter: "Eisen" },
{ common: "SchwÃ¤che", imposter: "Riss" },
{ common: "Geduld", imposter: "Sanduhr" },
{ common: "Wissen", imposter: "Buch" },
{ common: "Unwissenheit", imposter: "Dunkelheit" },

{ common: "GlÃ¼ck", imposter: "Klee" },
{ common: "Traurigkeit", imposter: "Regen" },
{ common: "Liebe", imposter: "Herz" },
{ common: "Hass", imposter: "Flamme" },
{ common: "Neid", imposter: "Gift" },
{ common: "Ehre", imposter: "Schwert" },
{ common: "Reichtum", imposter: "Gold" },
{ common: "Armut", imposter: "Schale" },
{ common: "Ordnung", imposter: "Regal" },
{ common: "Chaos", imposter: "Sturm" },

{ common: "Natur", imposter: "BlÃ¤tter" },
{ common: "Technologie", imposter: "Schaltkreis" },
{ common: "Zukunft", imposter: "Horizont" },
{ common: "Vergangenheit", imposter: "Staub" },
{ common: "Gegenwart", imposter: "Sekunde" },
{ common: "Kindheit", imposter: "Spielzeug" },
{ common: "Jugend", imposter: "Aufbruch" },
{ common: "Erwachsenenalter", imposter: "Verantwortung" },
{ common: "Alter", imposter: "Falten" },
{ common: "Tod", imposter: "Stille" },

{ common: "Geburt", imposter: "Schrei" },
{ common: "TrÃ¤ume", imposter: "Nebel" },
{ common: "Albtraum", imposter: "Dunkelheit" },
{ common: "KreativitÃ¤t", imposter: "Farben" },
{ common: "Kunst", imposter: "Leinwand" },
{ common: "Musik", imposter: "Noten" },
{ common: "Literatur", imposter: "Seiten" },
{ common: "Film", imposter: "Leinwand" },
{ common: "Theater", imposter: "Vorhang" },
{ common: "Tanz", imposter: "Bewegung" },

{ common: "Wissenschaft", imposter: "Mikroskop" },
{ common: "Religion", imposter: "Glaube" },
{ common: "Politik", imposter: "Redner" },
{ common: "Krieg", imposter: "TrÃ¼mmer" },
{ common: "Frieden", imposter: "Olive" },
{ common: "Revolution", imposter: "Fahne" },
{ common: "Demokratie", imposter: "Wahl" },
{ common: "Diktatur", imposter: "Eiserne Faust" },
{ common: "Gesetz", imposter: "Paragraph" },
{ common: "Vertrag", imposter: "Siegel" },

{ common: "Internet", imposter: "Netz" },
{ common: "Sprache", imposter: "Zunge" },
{ common: "Freundschaft", imposter: "Handschlag" },
{ common: "Partnerschaft", imposter: "Ring" },
{ common: "Familie", imposter: "Wurzeln" },
{ common: "Heimat", imposter: "Haus" },
{ common: "Reise", imposter: "Koffer" },
{ common: "Abschied", imposter: "Bahnhof" },
{ common: "RÃ¼ckkehr", imposter: "TÃ¼r" },
{ common: "ErinnerungsstÃ¼ck", imposter: "Souvenir" },

{ common: "Erfindung", imposter: "GlÃ¼hbirne" },
{ common: "Entdeckung", imposter: "Landkarte" },
{ common: "Naturgesetz", imposter: "Gravitation" },
{ common: "Universum", imposter: "Sterne" },
{ common: "Galaxie", imposter: "Spirale" },
{ common: "Planet", imposter: "Kugel" },
{ common: "Mond", imposter: "Krater" },
{ common: "Sonne", imposter: "Hitze" },
{ common: "Meer", imposter: "Wellen" },
{ common: "Berg", imposter: "Gipfel" },

{ common: "Wald", imposter: "BÃ¤ume" },
{ common: "WÃ¼ste", imposter: "Sand" },
{ common: "Fluss", imposter: "StrÃ¶mung" },
{ common: "Insel", imposter: "Abgeschiedenheit" },
{ common: "Stadt", imposter: "Lichter" },
{ common: "Dorf", imposter: "Brunnen" },
{ common: "Markt", imposter: "Stimmen" },
{ common: "StraÃŸe", imposter: "Asphalt" },
{ common: "BrÃ¼cke", imposter: "Verbindung" },
{ common: "Turm", imposter: "HÃ¶he" }


    ];

    // ---------- State Machine ----------
    const State = { START:'START', LOBBY:'LOBBY', REVEAL:'REVEAL', DISCUSS:'DISCUSS', VOTE:'VOTE', RESULT:'RESULT' };

    let game = {
      state: State.START,
      lang: 'de',
      category: 'general', // 'islamic' | 'general'
      players: [],
      topic: null,
      pool: TOPICS_GENERAL,
      imposterId: null,
      revealIndex: 0,
      discussEndsAt: 0,
      votes: {},
      options: { discussSeconds: 120, rounds: 1 },
      starterId: null
    };

    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>document.querySelectorAll(s);
    function uid(){ return Math.random().toString(36).slice(2,10); }
    function now(){ return Date.now(); }
    function t(key, vars={}){
      const str = (i18n[game.lang]?.[key] ?? i18n.de[key] ?? key);
      return str.replace(/\{(\w+)\}/g, (_,k)=> vars[k] ?? '');
    }
    function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${m}:${String(r).padStart(2,'0')}`; }

    function setLang(l){
      game.lang = l;
      document.documentElement.lang = l;
      document.body.dir = (l==='ar') ? 'rtl' : 'ltr';
      render();
    }

    function render(){
      const app = $('#app'); app.innerHTML='';

      if (game.state===State.START){
        const c = document.createElement('div'); c.className='card'; app.appendChild(c);
        c.innerHTML = `
          <div class="kicker">${t('start_title')}</div>
          <h2 style="margin:6px 0 0">${t('start_sub')}</h2>
          <div class="row" style="margin-top:14px">
            <div>
              <label>${t('language')}</label>
              <select id="langSel">
                <option value="de">Deutsch</option>
                <option value="en">English</option>
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
              </select>
            </div>
            <div>
              <label>${t('category')}</label>
              <select id="catSel">
                <option value="islamic">${t('cat_islamic')}</option>
                <option value="general" selected>${t('cat_general')}</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-top:12px">
            <button id="continueBtn" class="btn">${t('continue')}</button>
          </div>
        `;
        c.querySelector('#langSel').value = game.lang;
        c.querySelector('#langSel').onchange = (e)=> setLang(e.target.value);
        c.querySelector('#catSel').value = game.category;
        c.querySelector('#catSel').onchange = (e)=> {
          game.category = e.target.value;
          game.pool = (game.category==='islamic') ? TOPICS_ISLAMIC : TOPICS_GENERAL;
        };
        c.querySelector('#continueBtn').onclick = ()=> { game.state=State.LOBBY; render(); };
        return;
      }

      if (game.state===State.LOBBY){
        const c = document.createElement('div'); c.className='card'; app.appendChild(c);
        c.innerHTML = `
          <div class="kicker">${t('lobby_title')}</div>
          <div class="muted">${t('players_hint')}</div>

          <label style="margin-top:10px">${t('add_player')}</label>
          <div class="row" style="gap:10px">
            <input id="nameInput" placeholder="${t('name_placeholder')}" />
            <button id="addBtn" class="btn" style="flex:0 0 160px">${t('add_player')}</button>
          </div>

          <div id="players" class="row" style="margin-top:10px"></div>

          <div class="row" style="margin-top:12px">
            <div>
              <label>${t('discussion_secs')}</label>
              <input id="secs" type="number" min="30" max="600" value="${game.options.discussSeconds}">
            </div>
            <div>
              <label>${t('rounds')}</label>
              <input id="rounds" type="number" min="1" max="10" value="${game.options.rounds}">
            </div>
          </div>

          <button id="startBtn" class="btn" style="margin-top:16px" ${game.players.length<3?'disabled':''}>
            ${t('start_game')}
          </button>
        `;
        const bag = c.querySelector('#players');
        game.players.forEach(p=>{
          const tag = document.createElement('div');
          tag.className='player-tag';
          tag.textContent = p.name;
          bag.appendChild(tag);
        });
        c.querySelector('#addBtn').onclick = ()=>{
          const val = c.querySelector('#nameInput').value.trim();
          if(!val) return;
          game.players.push({ id:uid(), name:val });
          render();
        };
        c.querySelector('#secs').onchange = e => game.options.discussSeconds = Math.max(30, Math.min(600, +e.target.value||120));
        c.querySelector('#rounds').onchange = e => game.options.rounds = Math.max(1, Math.min(10, +e.target.value||1));
        c.querySelector('#startBtn').onclick = startGame;
        return;
      }

if (game.state===State.REVEAL){
  const current = game.players[game.revealIndex];
  const c = document.createElement('div'); c.className='card'; app.appendChild(c);

  const isLast = game.revealIndex >= game.players.length - 1;
  const nextLabel = isLast ? t('start_round') : t('next_player');

  c.innerHTML = `
    <div class="kicker">${t('reveal_title')}</div>
    <div class="muted">${t('pass_device_to', {name: current.name})}</div>

    <div class="reveal-wrap" style="margin-top:12px">
      <div class="reveal-content">
        <div class="big" id="wordVal" style="text-align:center">â€¢â€¢â€¢</div>
        <div class="pill" id="impTag" style="margin-top:8px; display:none">${t('you_are_imposter')}</div>
      </div>
      <div class="reveal-scrim" id="scrim">
        <div style="width:100%; display:flex; flex-direction:column; align-items:center">
          <div class="scrim-handle"></div>
          <div class="scrim-label">${t('swipe_up')}</div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="nextBtn" class="btn" disabled>${nextLabel}</button>
    </div>
  `;

  // Inhalt setzen (Wort + Imposter-Tag)
  const isImp = current.id === game.imposterId;
  const word = isImp ? game.topic.imposter : game.topic.common;
  c.querySelector('#wordVal').textContent = word;
  if (isImp) c.querySelector('#impTag').style.display = 'inline-flex';

  // Drag-to-reveal und â€Button erst nach Reveal aktivâ€œ
  const scrim = c.querySelector('#scrim');
  const nextBtn = c.querySelector('#nextBtn');
  let startY = null, curY = 0, revealed = false;

  function setY(y){
    curY = Math.max(-180, Math.min(0, y));
    scrim.style.transform = `translateY(${curY}px)`;
    if (curY <= -120 && !revealed) {
      revealed = true;
      nextBtn.disabled = false;           // JETZT ist der Button aktiv
      scrim.style.pointerEvents = 'none'; // scrim â€parktâ€œ oben
    }
  }
  const onStart = (clientY)=>{ startY = clientY; scrim.style.transition='none'; };
  const onMove = (clientY)=>{
    if(startY===null) return;
    const dy = clientY - startY;
    if (dy < 0) setY(dy); // only upwards
  };
  const onEnd = ()=>{
    scrim.style.transition='transform .18s ease';
    if (revealed) { setY(-210); } else { setY(0); }
    startY = null;
  };

  scrim.addEventListener('pointerdown', e=>{ scrim.setPointerCapture(e.pointerId); onStart(e.clientY); });
  scrim.addEventListener('pointermove', e=>onMove(e.clientY));
  scrim.addEventListener('pointerup', onEnd);
  scrim.addEventListener('pointercancel', onEnd);

  nextBtn.onclick = ()=>{
    game.revealIndex++;
    if (game.revealIndex >= game.players.length){
      // zufÃ¤lligen Starter wÃ¤hlen und in DISCUSS wechseln
      const startIdx = Math.floor(Math.random()*game.players.length);
      game.starterId = game.players[startIdx].id;
      game.state = State.DISCUSS;
      game.discussEndsAt = now() + game.options.discussSeconds*1000;
    }
    render();
  };

  return;
}
      if (game.state===State.DISCUSS){
        const c = document.createElement('div'); c.className='card'; app.appendChild(c);
        const starter = game.players.find(p=>p.id===game.starterId);
        const secsLeft = Math.max(0, Math.ceil((game.discussEndsAt - now())/1000));
        c.innerHTML = `
          <div class="kicker">${t('discuss_title')}</div>
          <div class="pill" style="margin-top:8px">${t('starter')}: <b>${starter?.name||'â€”'}</b></div>
          <p class="muted" style="margin-top:8px">${t('begin_prompt', {name: starter?.name||'â€”'})}</p>
          <div class="center" style="margin:14px 0">
            <div id="timer" class="big" style="font-variant-numeric:tabular-nums">${fmt(secsLeft)}</div>
          </div>
          <button id="toVoteBtn" class="btn">${secsLeft===0?t('go_vote'):t('early_vote')}</button>
        `;
        const interval = setInterval(()=>{
          if (game.state!==State.DISCUSS) return clearInterval(interval);
          const el = document.getElementById('timer');
          if(!el) return clearInterval(interval);
          const left = Math.max(0, Math.ceil((game.discussEndsAt - now())/1000));
          el.textContent = fmt(left);
          if(left<=0) clearInterval(interval);
        }, 300);
        c.querySelector('#toVoteBtn').onclick = ()=>{ game.state = State.VOTE; render(); };
        return;
      }

      if (game.state===State.VOTE){
        const c = document.createElement('div'); c.className='card'; app.appendChild(c);
        c.innerHTML = `
          <div class="kicker">${t('vote_title')}</div>
          <div id="voteGrid" class="grid" style="margin-top:10px"></div>
          <button id="finishBtn" class="btn" style="margin-top:14px" ${Object.keys(game.votes).length<game.players.length?'disabled':''}>${t('finish_vote')}</button>
        `;
        const grid = c.querySelector('#voteGrid');
        game.players.forEach(voter=>{
          const card = document.createElement('div');
          card.className='card'; card.style.background='#fff';
          card.innerHTML = `
            <div style="font-weight:800;margin-bottom:8px">${voter.name}</div>
            <select id="sel-${voter.id}">
              <option value="">${t('choose_sus')}</option>
              ${game.players.map(p=>`<option value="${p.id}">${p.name}</option>`).join('')}
            </select>
          `;
          grid.appendChild(card);
          const sel = card.querySelector(`#sel-${voter.id}`);
          sel.value = game.votes[voter.id] || '';
          sel.onchange=()=>{
            const v = sel.value;
            if (v===voter.id){ alert("No self-vote."); sel.value=game.votes[voter.id]||''; return; }
            if (v) game.votes[voter.id]=v; else delete game.votes[voter.id];
            document.getElementById('finishBtn').disabled = Object.keys(game.votes).length < game.players.length;
          };
        });
        c.querySelector('#finishBtn').onclick = ()=>{ game.state=State.RESULT; render(); };
        return;
      }

      if (game.state===State.RESULT){
        const c = document.createElement('div'); c.className='card'; app.appendChild(c);
        const tally = {};
        Object.values(game.votes).forEach(pid=>{ if(!pid) return; tally[pid]=(tally[pid]||0)+1; });
        const entries = Object.entries(tally).sort((a,b)=>b[1]-a[1]);
        const accusedId = (entries[0] && entries[1] && entries[0][1]===entries[1][1]) ? null : (entries[0]?.[0] || null);
        const accused = game.players.find(p=>p.id===accusedId);
        const imp = game.players.find(p=>p.id===game.imposterId);
        const win = accusedId===game.imposterId ? t('crew_wins') : t('imposter_wins');

        c.innerHTML = `
          <div class="kicker">${t('result_title')}</div>
          <h2 style="margin:6px 0 10px">${win}</h2>
          <div class="row">
            <div class="pill">Crew: <b>${game.topic.common}</b></div>
            <div class="pill">Imposter: <b>${game.topic.imposter}</b></div>
          </div>
          <div class="card" style="margin-top:12px;background:#fff">
            <div><b>${t('accused')}:</b> ${accused ? accused.name : 'â€”'}</div>
            <div><b>${t('imposter')}:</b> ${imp?.name||'â€”'}</div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="againBtn" class="btn">${t('play_again')}</button>
            <button id="resetBtn" class="btn btn-outline">${t('new_lobby')}</button>
          </div>
        `;
        c.querySelector('#againBtn').onclick=()=>{ nextRound(); render(); };
        c.querySelector('#resetBtn').onclick=()=>{ game = { ...game, state:State.START, players:[], votes:{}, topic:null, imposterId:null, starterId:null, revealIndex:0 }; render(); };
        return;
      }
    }

    function startGame(){
      if (game.players.length<3) return;
      // Thema aus gewÃ¤hltem Pool
      const pool = game.pool.length ? game.pool : TOPICS_GENERAL;
      game.topic = pool[Math.floor(Math.random()*pool.length)];
      // Imposter bestimmen
      const impIndex = Math.floor(Math.random()*game.players.length);
      game.imposterId = game.players[impIndex].id;
      game.revealIndex = 0;
      game.votes = {};
      game.state = State.REVEAL;
      render();
    }

    function nextRound(){
      const pool = game.pool.length ? game.pool : TOPICS_GENERAL;
      game.topic = pool[Math.floor(Math.random()*pool.length)];
      const impIndex = Math.floor(Math.random()*game.players.length);
      game.imposterId = game.players[impIndex].id;
      game.revealIndex = 0; game.votes = {}; game.state = State.REVEAL;
    }

    // init
    setLang('de'); // default
    render();
  })();
  </script>
</body>
</html>
